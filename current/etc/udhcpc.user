# This script is sourced by udhcpc's dhcp.script at every DHCP event.

# if udhcpc has been configured to request options via uci configuration:
#	uci set network.lan.reqopts='240'
# then data payload of options will appear in environment like so:

if [ "x$opt240" != "x" ]; then
        export custom_ssid=$(printf "%b" $(echo "$opt240" | sed 's/../\\x&/g'))
        logger -t SSID_HOTPLUG "Got SSID $custom_ssid"

        for ssid_path in $(uci show wireless | grep '\.ssid=' | cut -d= -f1); do
                uci set "$ssid_path=$custom_ssid"
                logger -t SSID_HOTPLUG "Set $ssid_path to $custom_ssid"
        done

        uci commit wireless
        wifi reload
fi
